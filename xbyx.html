<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å¯»å®å†’é™©æ¸¸æˆ</title>
    <style>
        :root {
            --primary-color: #FFD700;
            --secondary-color: #8B4513;
            --accent-color: #4CAF50;
            --danger-color: #F44336;
            --info-color: #2196F3;
            --dark-bg: rgba(0, 0, 0, 0.75);
            --light-bg: rgba(255, 255, 255, 0.1);
            --border-radius: 12px;
        }
        
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* æ›´æ¢ä¸ºä½ çš„æœ¬åœ°èƒŒæ™¯å›¾ç‰‡ */
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), 
                        url('mountain-8370051_1280.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        h1 {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5), 2px 2px 4px rgba(0, 0, 0, 0.8);
            animation: titleGlow 3s infinite alternate;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }
        
        h1::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }
        
        #game {
            max-width: 900px;
            width: 100%;
            margin: 20px auto;
            background: var(--dark-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .progress-container {
            flex: 1;
            min-width: 300px;
        }
        
        .progress-bar {
            width: 100%;
            background: var(--light-bg);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
            height: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #ff9800, #ff5722, #ff9800);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.7);
            position: relative;
            overflow: hidden;
        }
        
        .progress::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .map-container {
            position: relative;
            margin: 20px 0;
            background: rgba(10, 10, 20, 0.7);
            height: 220px;
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 2px solid var(--secondary-color);
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.5), inset 0 0 20px rgba(0, 0, 0, 0.5);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(30, 30, 60, 0.8) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(40, 20, 10, 0.6) 0%, transparent 50%);
        }
        
        .map-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .player {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--primary-color);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--primary-color);
            top: 20px;
            left: 40px;
            transition: all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 10;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .player::after {
            content: "â–²";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--primary-color);
            font-size: 12px;
            text-shadow: 0 0 5px black;
        }
        
        .player-trail {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255, 215, 0, 0.5);
            border-radius: 50%;
            z-index: 5;
            opacity: 0;
            animation: fadeTrail 1.5s forwards;
        }
        
        .location {
            position: absolute;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 5;
            transition: all 0.4s;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid transparent;
        }
        
        .location:hover {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .location.active {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px gold);
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid gold;
            z-index: 11;
        }
        
        .library { top: 20px; left: 40px; }
        .cave { top: 80px; left: 180px; }
        .temple { top: 40px; left: 320px; }
        .treasure { top: 100px; left: 460px; }
        .village { top: 140px; left: 250px; }
        .river { top: 60px; left: 120px; }
        
        .game-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
            }
        }
        
        .inventory {
            background: var(--light-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }
        
        .inventory h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .inventory-items {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            min-height: 60px;
        }
        
        .item {
            padding: 8px 12px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
            border-radius: 6px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            animation: itemPulse 3s infinite;
            border: 1px solid rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .item::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        .log {
            text-align: left;
            background: var(--light-bg);
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .log-entry {
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s;
            border-left: 3px solid;
        }
        
        .success { border-left-color: var(--accent-color); }
        .warning { border-left-color: var(--primary-color); }
        .info    { border-left-color: var(--info-color); }
        .error   { border-left-color: var(--danger-color); }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .controls button {
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, var(--accent-color), #2E7D32);
            color: white;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-weight: bold;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .controls button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .controls button:hover {
            background: linear-gradient(45deg, #66BB6A, #388E3C);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .controls button:hover::before {
            left: 100%;
        }
        
        .controls button:active {
            transform: translateY(-1px);
        }
        
        .controls button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .controls button:disabled:hover::before {
            left: -100%;
        }
        
        #choices {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        #choices button {
            padding: 12px 20px;
            margin: 8px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(45deg, var(--info-color), #1565C0);
            color: white;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            font-weight: bold;
        }
        
        #choices button:hover {
            background: linear-gradient(45deg, #42A5F5, #1976D2);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        #music-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 10px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        #music-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        #music-btn.playing {
            background: #2196F3;
        }

        /* ç‰¹æ•ˆå…ƒç´  */
        .effects-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }
        
        .lightning {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 30%, rgba(255,255,255,0.8) 50%, transparent 70%);
            opacity: 0;
            pointer-events: none;
        }
        
        .fire-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,100,0,0.8) 0%, rgba(255,50,0,0) 70%);
            opacity: 0;
            pointer-events: none;
        }
        
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: gold;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }
        
        .floating-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 215, 0, 0.7);
            border-radius: 50%;
            animation: float 5s infinite linear;
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5), 2px 2px 4px rgba(0, 0, 0, 0.8); }
            100% { text-shadow: 0 0 20px gold, 0 0 30px orange, 2px 2px 4px rgba(0, 0, 0, 0.8); }
        }
        
        @keyframes fadeTrail {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        @keyframes itemPulse {
            0% { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); }
            50% { box-shadow: 0 2px 10px gold, 0 0 15px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); }
        }
        
        @keyframes lightningFlash {
            0% { opacity: 0; }
            10% { opacity: 0.8; }
            20% { opacity: 0; }
            30% { opacity: 0.6; }
            40% { opacity: 0; }
            100% { opacity: 0; }
        }
        
        @keyframes fireFlicker {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 0.7; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        
        @keyframes sparkleEffect {
            0% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0); }
        }
        
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(20px); opacity: 0; }
        }
        
        /* æ·»åŠ ä¸€äº›æµ®åŠ¨ç²’å­ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯ç²’å­æ•ˆæœ -->
    <div class="particles" id="particles"></div>
    
    <h1>ğŸï¸ å¯»å®å†’é™©æ¸¸æˆ</h1>
    
    <div id="game">
        <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
        <button id="music-btn">ğŸµ å¼€å¯éŸ³ä¹</button>

        <div class="game-header">
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress" class="progress"></div>
                </div>
                <div class="progress-text">æ¢é™©è¿›åº¦: <span id="progress-percent">0%</span></div>
            </div>
        </div>
        
        <!-- å°åœ°å›¾ -->
        <div class="map-container">
            <div class="map-grid"></div>
            <div id="player" class="player"></div>
            <div class="location library">ğŸ“š å›¾ä¹¦é¦†</div>
            <div class="location cave">ğŸ•³ æ´ç©´</div>
            <div class="location temple">ğŸ› ç¥åº™</div>
            <div class="location treasure">ğŸ’ å®è—</div>
            <div class="location village">ğŸ˜ï¸ æ‘åº„</div>
            <div class="location river">ğŸŒŠ æ²³æµ</div>
            
            <!-- ç‰¹æ•ˆå®¹å™¨ -->
            <div id="effects-container" class="effects-container"></div>
        </div>

        <div class="game-content">
            <!-- é“å…·æ  -->
            <div class="inventory">
                <h3>ğŸ’ é“å…·æ </h3>
                <div id="inventory-items" class="inventory-items">ï¼ˆç©ºç©ºå¦‚ä¹Ÿï¼‰</div>
            </div>

            <div class="log" id="log"></div>
        </div>
        
        <div id="choices"></div>
        
        <div class="controls">
            <button id="start-btn" onclick="startGame()">å¼€å§‹å¯»å®</button>
            <button id="reset-btn" onclick="resetGame()">é‡ç½®æ¸¸æˆ</button>
        </div>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bg-music" loop>
        <source src="relaxing-guitar-loop-v5-245859.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ 
    </audio>

    <script>
        // æ¸¸æˆå…ƒç´ 
        const logDiv = document.getElementById('log');
        const progressBar = document.getElementById('progress');
        const progressPercent = document.getElementById('progress-percent');
        const choices = document.getElementById('choices');
        const inventoryDiv = document.getElementById('inventory-items');
        const music = document.getElementById('bg-music');
        const musicBtn = document.getElementById('music-btn');
        const player = document.getElementById('player');
        const effectsContainer = document.getElementById('effects-container');
        const locations = document.querySelectorAll('.location');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const particlesContainer = document.getElementById('particles');

        // æ¸¸æˆçŠ¶æ€
        let progress = 0;
        let inventory = [];
        let muted = false;
        let gameActive = false;

        // éŸ³ä¹æ§åˆ¶åŠŸèƒ½
        function initMusicControls() {
            // è®¾ç½®éŸ³é‡
            music.volume = 0.3;
            
            // éŸ³ä¹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            musicBtn.addEventListener('click', function() {
                if (music.paused) {
                    music.play().then(() => {
                        musicBtn.textContent = 'â¸ï¸ éŸ³ä¹æ’­æ”¾ä¸­';
                        musicBtn.classList.add('playing');
                    }).catch(error => {
                        console.log('æ’­æ”¾å¤±è´¥:', error);
                        musicBtn.textContent = 'âŒ ç‚¹å‡»é‡è¯•';
                    });
                } else {
                    music.pause();
                    musicBtn.textContent = 'ğŸµ å¼€å¯éŸ³ä¹';
                    musicBtn.classList.remove('playing');
                }
            });
            
            // é¡µé¢ç‚¹å‡»æ—¶å°è¯•è‡ªåŠ¨æ’­æ”¾
            document.addEventListener('click', function initAutoPlay() {
                if (music.paused) {
                    music.play().then(() => {
                        musicBtn.textContent = 'â¸ï¸ éŸ³ä¹æ’­æ”¾ä¸­';
                        musicBtn.classList.add('playing');
                    }).catch(e => {
                        // è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢æ˜¯æ­£å¸¸çš„
                    });
                }
                // ç§»é™¤ç›‘å¬å™¨ï¼Œé¿å…é‡å¤ç»‘å®š
                document.removeEventListener('click', initAutoPlay);
            });
        }

        // åˆå§‹åŒ–èƒŒæ™¯ç²’å­
        function initParticles() {
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'floating-particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 5) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLog(message, type="info") {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(val) {
            progress = Math.min(100, Math.max(0, progress + val));
            progressBar.style.width = progress + '%';
            progressPercent.textContent = progress + '%';
        }

        // æ›´æ–°é“å…·æ 
        function updateInventory() {
            inventoryDiv.innerHTML = '';
            if (inventory.length === 0) {
                inventoryDiv.textContent = 'ï¼ˆç©ºç©ºå¦‚ä¹Ÿï¼‰';
                return;
            }
            inventory.forEach(item => {
                const span = document.createElement('span');
                span.className = 'item';
                span.textContent = item;
                inventoryDiv.appendChild(span);
            });
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            logDiv.innerHTML = '';
            progress = 0;
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            inventory = [];
            updateInventory();
            choices.style.display = 'none';
            movePlayer("library");
            addLog("æ¸¸æˆå·²é‡ç½®ï¼Œè¯·ç‚¹å‡»ã€å¼€å§‹å¯»å®ã€‘é‡æ–°å¼€å§‹ã€‚", 'warning');
            gameActive = false;
            
            // é‡ç½®æ‰€æœ‰åœ°ç‚¹çŠ¶æ€
            locations.forEach(loc => loc.classList.remove('active'));
            document.querySelector('.library').classList.add('active');
            
            // å¯ç”¨æŒ‰é’®
            startBtn.disabled = false;
            resetBtn.disabled = false;
        }

        // å»¶è¿Ÿå‡½æ•°
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // æ˜¾ç¤ºé€‰æ‹©æŒ‰é’®
        function showChoices(options) {
            return new Promise(resolve => {
                choices.innerHTML = '';
                choices.style.display = 'flex';
                choices.style.flexWrap = 'wrap';
                choices.style.justifyContent = 'center';
                
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.textContent = opt.label;
                    btn.onclick = () => {
                        choices.style.display = 'none';
                        resolve(opt.value);
                    };
                    choices.appendChild(btn);
                });
            });
        }

        // ç§»åŠ¨ç©å®¶
        function movePlayer(location) {
            // åˆ›å»ºç§»åŠ¨è½¨è¿¹
            createPlayerTrail();
            
            // æ›´æ–°åœ°ç‚¹æ¿€æ´»çŠ¶æ€
            locations.forEach(loc => loc.classList.remove('active'));
            document.querySelector(`.${location}`).classList.add('active');
            
            switch(location) {
                case "library":
                    player.style.top = "20px"; player.style.left = "40px"; break;
                case "cave":
                    player.style.top = "80px"; player.style.left = "180px"; break;
                case "temple":
                    player.style.top = "40px"; player.style.left = "320px"; break;
                case "treasure":
                    player.style.top = "100px"; player.style.left = "460px"; break;
                case "village":
                    player.style.top = "140px"; player.style.left = "250px"; break;
                case "river":
                    player.style.top = "60px"; player.style.left = "120px"; break;
            }
        }

        // åˆ›å»ºç©å®¶ç§»åŠ¨è½¨è¿¹
        function createPlayerTrail() {
            const trail = document.createElement('div');
            trail.className = 'player-trail';
            trail.style.top = player.style.top;
            trail.style.left = player.style.left;
            document.querySelector('.map-container').appendChild(trail);
            
            // è‡ªåŠ¨ç§»é™¤è½¨è¿¹
            setTimeout(() => {
                if (trail.parentNode) {
                    trail.parentNode.removeChild(trail);
                }
            }, 1500);
        }

        // ç‰¹æ•ˆå‡½æ•°
        function createLightning() {
            const lightning = document.createElement('div');
            lightning.className = 'lightning';
            effectsContainer.appendChild(lightning);
            
            lightning.style.animation = 'lightningFlash 2s forwards';
            
            setTimeout(() => {
                if (lightning.parentNode) {
                    lightning.parentNode.removeChild(lightning);
                }
            }, 2000);
        }

        function createFireEffect(x, y) {
            const fire = document.createElement('div');
            fire.className = 'fire-effect';
            fire.style.left = `${x}px`;
            fire.style.top = `${y}px`;
            effectsContainer.appendChild(fire);
            
            fire.style.animation = 'fireFlicker 1.5s forwards';
            
            setTimeout(() => {
                if (fire.parentNode) {
                    fire.parentNode.removeChild(fire);
                }
            }, 1500);
        }

        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = `${x}px`;
            sparkle.style.top = `${y}px`;
            effectsContainer.appendChild(sparkle);
            
            sparkle.style.animation = 'sparkleEffect 1s forwards';
            
            setTimeout(() => {
                if (sparkle.parentNode) {
                    sparkle.parentNode.removeChild(sparkle);
                }
            }, 1000);
        }

        function shakeScreen() {
            document.getElementById('game').style.animation = 'shake 0.5s';
            setTimeout(() => {
                document.getElementById('game').style.animation = '';
            }, 500);
        }

        // æ¸¸æˆé€»è¾‘
        const TreasureMap = {
            startJourney: async function() {
                movePlayer("library");
                addLog("ä½ è¸ä¸Šäº†ç¥ç§˜çš„å¯»å®ä¹‹æ—…...", 'info');
                updateProgress(10);
                await delay(1000);
                return "ä¼ è¯´å®è—è—åœ¨è¿œå¤çš„ç¥åº™ä¸­ã€‚";
            },
            
            exploreLibrary: async function() {
                movePlayer("library");
                await delay(1200);
                addLog("ä½ åœ¨å›¾ä¹¦é¦†å‘ç°äº†ä¸€æœ¬å¤ä¹¦ï¼Œä¹¦ä¸­è®°è½½äº†å®è—çš„çº¿ç´¢ã€‚", 'info');
                inventory.push("å¤ä¹¦");
                updateInventory();
                return "å¤ä¹¦è®°è½½ï¼šå®è—è¢«è—åœ¨ç¥åº™æœ€æ·±å¤„çš„å¯†å®¤ä¸­ã€‚";
            },
            
            crossRiver: async function() {
                movePlayer("river");
                await delay(1000);
                addLog("ä½ æ¥åˆ°ä¸€æ¡æ¹æ€¥çš„æ²³æµå‰ï¼Œéœ€è¦æƒ³åŠæ³•è¿‡æ²³ã€‚", 'info');
                const choice = await showChoices([
                    { label: "å¯»æ‰¾æµ…æ»©è¿‡æ²³", value: "ford" },
                    { label: "åˆ¶ä½œç®€æ˜“æœ¨ç­", value: "raft" },
                    { label: "ç»•é“è€Œè¡Œ", value: "detour" }
                ]);
                
                if (choice === "ford") {
                    if (Math.random() < 0.4) {
                        createLightning();
                        shakeScreen();
                        throw new Error("æ²³æ°´çªç„¶æš´æ¶¨ï¼Œä½ è¢«å†²èµ°äº†ï¼");
                    }
                    return "ä½ æˆåŠŸæ‰¾åˆ°äº†æµ…æ»©ï¼Œå®‰å…¨è¿‡æ²³ã€‚";
                } else if (choice === "raft") {
                    inventory.push("æœ¨ç­");
                    updateInventory();
                    return "ä½ åˆ¶ä½œäº†ç®€æ˜“æœ¨ç­ï¼Œé¡ºåˆ©è¿‡æ²³ã€‚";
                } else {
                    updateProgress(-5); // ç»•é“æ¶ˆè€—æ—¶é—´
                    return "ä½ é€‰æ‹©äº†ç»•é“ï¼Œè™½ç„¶å¤šèŠ±äº†æ—¶é—´ä½†å®‰å…¨åˆ°è¾¾å¯¹å²¸ã€‚";
                }
            },
            
            visitVillage: async function() {
                movePlayer("village");
                await delay(1200);
                addLog("ä½ æ¥åˆ°ä¸€ä¸ªå°æ‘åº„ï¼Œæ‘æ°‘ä»¬å¯¹ä½ å¾ˆå‹å¥½ã€‚", 'info');
                const choice = await showChoices([
                    { label: "å‘æ‘æ°‘æ‰“å¬æ¶ˆæ¯", value: "ask" },
                    { label: "åœ¨æ‘åº„ä¼‘æ¯", value: "rest" },
                    { label: "ç›´æ¥ç¦»å¼€", value: "leave" }
                ]);
                
                if (choice === "ask") {
                    if (Math.random() < 0.7) {
                        inventory.push("ç¥åº™åœ°å›¾");
                        updateInventory();
                        return "ä¸€ä½è€è€…ç»™äº†ä½ ä¸€å¼ ç¥åº™çš„åœ°å›¾ï¼Œè¿™ä¼šå¯¹ä½ æœ‰å¸®åŠ©ï¼";
                    }
                    return "æ‘æ°‘ä»¬çŸ¥é“çš„ä¸å¤šï¼Œä½†ä½ å¾—åˆ°äº†ä¸€äº›é£Ÿç‰©è¡¥ç»™ã€‚";
                } else if (choice === "rest") {
                    updateProgress(5); // ä¼‘æ¯æ¢å¤ä½“åŠ›
                    return "ä½ åœ¨æ‘åº„ä¼‘æ¯äº†ä¸€æ™šï¼Œä½“åŠ›æ¢å¤äº†ã€‚";
                } else {
                    return "ä½ åŒ†åŒ†ç¦»å¼€äº†æ‘åº„ï¼Œç»§ç»­ä½ çš„æ—…ç¨‹ã€‚";
                }
            },
            
            exploreCave: async function() {
                movePlayer("cave");
                await delay(1200);
                
                // éšæœºäº‹ä»¶ï¼šæ´ç©´ä¸­çš„ç«å…‰
                if (Math.random() < 0.5) {
                    createFireEffect(160, 60);
                    addLog("æ´ç©´æ·±å¤„æœ‰å¥‡æ€ªçš„ç«å…‰...", 'warning');
                    await delay(800);
                }
                
                addLog("æ´ç©´å†…åˆ†æˆäº†ä¸¤æ¡è·¯ï¼Œä½ é€‰æ‹©å“ªæ¡ï¼Ÿ", 'info');
                const choice = await showChoices([
                    { label: "å·¦è¾¹(æœ‰å…‰äº®)", value: "left" },
                    { label: "å³è¾¹(é˜´æš—ç‹­çª„)", value: "right" },
                    { label: "æ¢ç´¢æ´ç©´å…¥å£", value: "entrance" }
                ]);
                
                if (choice === "left") {
                    inventory.push("ç«æŠŠ");
                    updateInventory();
                    createFireEffect(160, 60);
                    return "ä½ åœ¨å…‰äº®å¤„å‘ç°äº†ä¸€åªç«æŠŠ! å®ƒä¼šå¸®åŠ©ä½ åœ¨é»‘æš—ä¸­å‰è¿›ã€‚";
                } else if (choice === "right") {
                    if (Math.random() < 0.5) {
                        createLightning();
                        shakeScreen();
                        throw new Error("ä½ æ‰è¿›é™·é˜±ï¼Œæ¸¸æˆå¤±è´¥!");
                    }
                    return "å°å¿ƒç¿¼ç¿¼ç©¿è¿‡é»‘æš—é€šé“ï¼Œä½ æ‰¾åˆ°äº†ä¸€æ¡é€šå¾€ç¥åº™çš„å¯†é“!";
                } else {
                    if (inventory.includes("å¤ä¹¦")) {
                        inventory.push("ç¥ç§˜é’¥åŒ™");
                        updateInventory();
                        createSparkle(160, 70);
                        return "ä½ åœ¨æ´ç©´å…¥å£å‘ç°äº†ä¸€æŠŠç¥ç§˜çš„é’¥åŒ™ï¼Œå¯èƒ½ä¸å®è—æœ‰å…³ï¼";
                    }
                    return "ä½ åœ¨æ´ç©´å…¥å£å‘ç°äº†ä¸€äº›å¤è€çš„å£ç”»ï¼Œä½†æ²¡æœ‰æ›´å¤šæ”¶è·ã€‚";
                }
            },
            
            searchTemple: async function() {
                movePlayer("temple");
                await delay(1500);
                
                // éšæœºäº‹ä»¶ï¼šç¥åº™éœ‡åŠ¨
                if (Math.random() < 0.3) {
                    shakeScreen();
                    addLog("ç¥åº™çªç„¶éœ‡åŠ¨èµ·æ¥ï¼", 'warning');
                    await delay(800);
                }
                
                addLog("ä½ åœ¨ç¥åº™é—¨å£é‡åˆ°å®ˆå«ï¼Œæ€ä¹ˆåŠï¼Ÿ", 'warning');
                const choice = await showChoices([
                    { label: "å¼ºè¡Œçªç ´", value: "fight" },
                    { label: "å·å·æ½œè¡Œ", value: "sneak" },
                    { label: "å°è¯•è´¿èµ‚", value: "bribe" }
                ]);
                
                if (choice === "fight") {
                    if (inventory.includes("ç«æŠŠ") && Math.random() > 0.4) {
                        createFireEffect(300, 20);
                        return "ä½ ç”¨ç«æŠŠå“é€€äº†å®ˆå«ï¼Œé¡ºåˆ©è¿›å…¥ç¥åº™!";
                    } else {
                        throw new Error("å®ˆå«å¤ªå¼ºå¤§ï¼Œä½ è¢«å‡»è´¥äº†...");
                    }
                } else if (choice === "sneak") {
                    if (Math.random() < 0.6) return "ä½ æˆåŠŸç»•è¿‡å®ˆå«ï¼Œæ‚„æ‚„è¿›å…¥äº†ç¥åº™!";
                    throw new Error("æ½œè¡Œå¤±è´¥ï¼Œè¢«å®ˆå«å‘ç°!");
                } else {
                    if (inventory.includes("å¤ä¹¦")) {
                        return "ä½ å±•ç¤ºå¤ä¹¦ï¼Œå®ˆå«è®¤å‡ºä½ æ˜¯è¢«é€‰ä¸­çš„äººï¼Œè®©ä½ è¿›å…¥ç¥åº™!";
                    }
                    throw new Error("ä½ æ²¡æœ‰è¶³å¤Ÿè´µé‡çš„ä¸œè¥¿è´¿èµ‚å®ˆå«!");
                }
            },
            
            openTreasureBox: async function() {
                movePlayer("treasure");
                await delay(1200);
                
                // å®è—å¼€å¯ç‰¹æ•ˆ
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createSparkle(
                            Math.random() * 400 + 430,
                            Math.random() * 100 + 80
                        );
                    }, i * 100);
                }
                
                                if (Math.random() < 0.2) {
                    return "ä½ æ‰“å¼€å®ç®±ï¼Œé‡Œé¢ç«Ÿæ˜¯ä¸€å°å¤è€çš„ä¿¡ï¼šçœŸæ­£çš„å®è—æ˜¯ã€çŸ¥è¯†ã€! (éšè—ç»“å±€)";
                }
                if (Math.random() < 0.3) {
                    throw new Error("ç®±å­æ˜¯ç©ºçš„ï¼Œåç»“å±€!");
                }
                return "æ­å–œ! ä½ æ‰¾åˆ°äº†ä¸€é¢—ç’€ç’¨çš„" + 
                       ["é’»çŸ³","çº¢å®çŸ³","è“å®çŸ³","ç¥–æ¯ç»¿","ç¥ç§˜æ°´æ™¶"][Math.floor(Math.random()*5)] + "!";
            }
        };

        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
            if (gameActive) return;
            gameActive = true;
            
            // ç¦ç”¨æŒ‰é’®
            startBtn.disabled = true;
            resetBtn.disabled = true;
            
            try {
                logDiv.innerHTML = '';
                inventory = [];
                updateInventory();
                progress = 0;
                updateProgress(0);
                
                // å¼€å§‹æ¸¸æˆæµç¨‹
                addLog("å¯»å®å†’é™©å¼€å§‹ï¼", 'success');
                
                // ç¬¬ä¸€æ­¥ï¼šå¼€å§‹æ—…ç¨‹
                let result = await TreasureMap.startJourney();
                addLog(result, 'info');
                await delay(1500);
                
                // ç¬¬äºŒæ­¥ï¼šæ¢ç´¢å›¾ä¹¦é¦†
                result = await TreasureMap.exploreLibrary();
                addLog(result, 'info');
                updateProgress(10);
                await delay(1500);
                
                // ç¬¬ä¸‰æ­¥ï¼šè¿‡æ²³
                result = await TreasureMap.crossRiver();
                addLog(result, 'success');
                updateProgress(15);
                await delay(1500);
                
                // ç¬¬å››æ­¥ï¼šè®¿é—®æ‘åº„
                result = await TreasureMap.visitVillage();
                addLog(result, 'info');
                updateProgress(10);
                await delay(1500);
                
                // ç¬¬äº”æ­¥ï¼šæ¢ç´¢æ´ç©´
                result = await TreasureMap.exploreCave();
                addLog(result, 'success');
                updateProgress(15);
                await delay(1500);
                
                // ç¬¬å…­æ­¥ï¼šæœç´¢ç¥åº™
                result = await TreasureMap.searchTemple();
                addLog(result, 'success');
                updateProgress(20);
                await delay(1500);
                
                // ç¬¬ä¸ƒæ­¥ï¼šæ‰“å¼€å®è—
                result = await TreasureMap.openTreasureBox();
                addLog("âœ¨ " + result, 'success');
                updateProgress(30);
                
                // èƒœåˆ©ç‰¹æ•ˆ
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        createSparkle(
                            Math.random() * 800 + 50,
                            Math.random() * 400 + 50
                        );
                    }, i * 150);
                }
                
                addLog("ğŸ‰ æ­å–œä½ å®Œæˆäº†å¯»å®å†’é™©ï¼", 'success');
                
            } catch (error) {
                addLog("ğŸ’€ " + error.message, 'error');
                createLightning();
                shakeScreen();
                addLog("æ¸¸æˆç»“æŸï¼ç‚¹å‡»ã€é‡ç½®æ¸¸æˆã€‘é‡æ–°å¼€å§‹ã€‚", 'warning');
            } finally {
                // é‡æ–°å¯ç”¨é‡ç½®æŒ‰é’®
                resetBtn.disabled = false;
                gameActive = false;
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆå§‹åŒ–éŸ³ä¹æ§åˆ¶
            initMusicControls();
            
            // åˆå§‹åŒ–ç²’å­æ•ˆæœ
            initParticles();
            
            // è®¾ç½®åˆå§‹ç©å®¶ä½ç½®
            movePlayer("library");
            document.querySelector('.library').classList.add('active');
            
            // æ·»åŠ åˆå§‹æ—¥å¿—
            addLog("æ¬¢è¿æ¥åˆ°å¯»å®å†’é™©æ¸¸æˆï¼", 'info');
            addLog("ç‚¹å‡»ã€å¼€å§‹å¯»å®ã€‘æŒ‰é’®å¼€å§‹ä½ çš„å†’é™©ã€‚", 'info');
            
            // æ·»åŠ ä¸€äº›è§†è§‰ç‰¹æ•ˆ
            setTimeout(() => {
                createSparkle(100, 100);
                createSparkle(700, 200);
            }, 1000);
            
            // æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ˜¯å¦å¯åŠ è½½
            music.addEventListener('canplaythrough', function() {
                console.log('èƒŒæ™¯éŸ³ä¹æ–‡ä»¶åŠ è½½æˆåŠŸ');
            });
            
            music.addEventListener('error', function(e) {
                console.log('èƒŒæ™¯éŸ³ä¹æ–‡ä»¶åŠ è½½å¤±è´¥:', e);
                musicBtn.textContent = 'âŒ éŸ³ä¹åŠ è½½å¤±è´¥';
                musicBtn.style.background = '#f44336';
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>
